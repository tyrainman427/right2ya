{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1>Payment Confirmation</h1>
  <p>Please complete the payment to schedule the job:</p>
  <p>Amount: ${{ scheduled_job.price }}</p>
  <div id="card-element"></div>
  <button id="submit-payment">Complete Payment</button>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
  var stripe = Stripe('{{ settings.STRIPE_PUBLIC_KEY }}');
  var elements = stripe.elements();

  var cardElement = elements.create('card');
  cardElement.mount('#card-element');

  var submitButton = document.getElementById('submit-payment');
  submitButton.addEventListener('click', function() {
    stripe.confirmCardPayment('{{ client_secret }}', {
      payment_method: {
        card: cardElement,
        billing_details: {
          name: '{{ request.user.customer.get_full_name }}',
          email: '{{ request.user.email }}',
        }
      }
    }).then(function(result) {
      if (result.error) {
        // Handle payment error
        console.error(result.error.message);
      } else {
        // Payment successful, redirect or do further processing
        window.location.href = '/success_page';
      }
    });
  });
</script>
{% endblock %}
